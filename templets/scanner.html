<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scan & Store Barcode</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-5">
    <form action="/scanner" method="post">
  <div class="container bg-white shadow rounded p-4" style="max-width: 500px;">
    <h3 class="mb-3 text-center">üì¶ Scan Barcode</h3>
     
    <input type="text" class="form-control" id="barcodeInput" name="addl" value="{{query}}" placeholder="Scan here..." autofocus><br>
    <div class="mb-3">
        <label for="locationInput" class="form-label">Add Location</label>
        <input type="text" class="form-control" id="locationInput" name="locationInput" placeholder="Scan barcode here" required>
      </div>
    <p id="status" class="mt-3 text-success text-center d-none">‚úîÔ∏è Saved</p>
  </div>
</form>
  <div class="container">
    <h2 class="mb-4">Imported Data Table</h2>

    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                {% comment %} <th>Location</th>
                <th>Addl</th>
                <th>Item Code</th>
                <th>Item Name</th>
                <th>Size</th>
                <th>Qty</th> {% endcomment %}
                <th>ID</th>
                <th>Itemname</th>
                <th>Date&Time</th>

            </tr>
        </thead>
        <tbody>
            {% for row in records %}
            <tr>
                <td>{{ row.id }}</td>
                <td>{{ row.code }}</td>
                <td>{{ row.scanned_at }}</td>
                {% comment %} <td>{{ row.itemname }}</td>
                <td>{{ row.size }}</td>
                <td>{{ row.qty }}</td> {% endcomment %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- templates/show_records.html -->
<!-- <form method="get">
  <input type="text" name="addl" placeholder="Enter ADDL value" required>
  <button type="submit">Search</button>
</form> -->
<!-- 
{% if records %}
  <h3>Records for Addl: {{ addl }}</h3>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Location</th>
        <th>Addl</th>
        <th>Itemcode</th>
        <th>Itemname</th>
        <th>Size</th>
        <th>Qty</th>
      </tr>
    </thead>
    <tbody>
      {% for record in records %}
        <tr>
          <td>{{ record.location }}</td>
          <td>{{ record.addl }}</td>
          <td>{{ record.itemcode }}</td>
          <td>{{ record.itemname }}</td>
          <td>{{ record.size }}</td>
          <td>{{ record.qty }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  {% if addl %}
    <p>No records found for "{{ addl }}".</p>
  {% endif %}
{% endif %} -->



  <script>
    const barcodeInput = document.getElementById('barcodeInput');
    const statusMsg = document.getElementById('status');

    barcodeInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const barcode = barcodeInput.value.trim();
        if (barcode !== '') {
          fetch('/savebarcode/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            
            body: 'barcode=' + encodeURIComponent(barcode)
            
            
          })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              statusMsg.classList.remove('d-none');
              setTimeout(() => statusMsg.classList.add('d-none'), 1500);
              barcodeInput.value = '';
            }
          });
        }
      }
    });

    // Always refocus input field
    window.onload = () => barcodeInput.focus();
    window.onclick = () => barcodeInput.focus();
  </script>
</body>
</html>
