<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Audit-Manager Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .sidebar {
      height: 100vh;
      background-color: #1f2937;
      color: white;
      padding-top: 20px;
      position: fixed;
      width: 250px;
      transition: all 0.3s;
      z-index: 1050;
    }

    .sidebar a {
      color: white;
      text-decoration: none;
      display: block;
      padding: 12px 20px;
      font-size: 16px;
    }

    .sidebar a:hover {
      background-color: #374151;
      border-radius: 5px;
    }

    .main-content {
      margin-left: 250px;
      padding: 20px;
      transition: all 0.3s;
    }

    /* Ensure table scrolls on small screens */
    .table-responsive {
      overflow-x: auto;
    }

    /* Sidebar adjustments */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        top: 0;
        left: -250px;
        height: 100%;
        transition: left 0.3s ease;
      }

      .sidebar.active {
        left: 0;
      }

      .main-content {
        margin-left: 0;
      }
    }

    /* Hide sidebar and shift content for small screens */
    @media (max-width: 768px) {
      .sidebar {
        left: -250px;
      }

      .sidebar.active {
        left: 0;
      }

      .main-content {
        margin-left: 0;
      }

      .overlay {
        display: none;
        position: fixed;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        top: 0;
        left: 0;
        z-index: 1040;
      }

      .overlay.active {
        display: block;
      }
    }
  </style>
</head>

<body>

  <!-- Toggle Button (hamburger) -->
  <nav class="navbar bg-dark d-md-none">
    <div class="container-fluid">
      <button class="btn btn-outline-light" id="menu-toggle">‚ò∞</button>
      <span class="navbar-brand mb-0 h1 text-white">Audit-Manager</span>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h4 class="text-start">Audit-Manager</h4>
    <h5>Welcome {{request.user}}</h5>
    <hr style="border-color: rgba(255, 255, 255, 0.2)">
    <a href="/">üè† Home</a>
    <a href="/dataEnter">üì∑ Scanning-File</a>
    <a href="/scan/">üì∑ Scanning-Record</a>


  </div>

  <!-- Mobile overlay -->
  <div class="overlay" id="overlay"></div>

  <!-- Main content -->
  <div class="main-content p-4">
    <div class="container mt-4">

      <!-- Django Messages -->
      {% if messages %}
      <div class="container mt-2">
        {% for message in messages %}
        <div class="alert
       {% if message.tags == 'success' %} alert-success
       {% elif message.tags == 'error' %} alert-danger
       {% else %} alert-info {% endif %}
       alert-dismissible fade show message-alert" role="alert">

          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
      </div>
      {% endif %}




      <div class="card shadow">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">Location & Item Entry</h5>
        </div><br>
        <!-- Bootstrap 5 Nav Tabs -->
        <ul class="nav nav-tabs mb-3" id="barcodeTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="setlocation-tab" data-bs-toggle="tab" data-bs-target="#setlocation-pane"
              type="button" role="tab" aria-controls="setlocation-pane" aria-selected="true">
              Set Location
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="countdata-tab" data-bs-toggle="tab" data-bs-target="#countdata-pane"
              type="button" role="tab" aria-controls="countdata-pane" aria-selected="false">
              Count Data
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="barcodeTabContent">

          <!-- üîß Set Location Tab Pane -->
          <div class="tab-pane fade show active" id="setlocation-pane" role="tabpanel"
            aria-labelledby="setlocation-tab">
            <div class="row">
              <div class="col-md-6 mb-4">
                <div class="card shadow p-3">
                  <h5 class="card-title">Add Location</h5>
                  <form action="/dataEnter" method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                      <label for="lno" class="form-label">Add Location No:</label>
                      <input type="text" name="lno" id="lno" class="form-control" placeholder="Enter Location">
                    </div>
                    <button type="submit" class="btn btn-primary w-100" onclick="ls()">Set Location</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- üî¢ Count Data Tab Pane -->
          <div class="tab-pane fade  " id="countdata-pane" role="tabpanel" aria-labelledby="countdata-tab">
            <div class="row">
              <div class="col-md-6 mb-4">
                <div class="card shadow p-3">
                  <h5 class="card-title">Count Data</h5>
                  <form action="/dataEnter" method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                      <label for="lc" class="form-label">Count Data:</label>
                      <input type="text" name="lc" id="lc" class="form-control" placeholder="Enter Count">
                    </div>
                    <button type="submit" class="btn btn-success w-100">Count</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="row">
          <div class="col-12">
            <div class="alert alert-info shadow">
              <p class="mb-0">Total Data With Location: <strong>{{ lCount }}</strong></p>
            </div>
          </div>
        </div>
      </div><br>

      <div class="card-body">
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
          <form action="/dataEnter" method="post" id="myForm">
            {% csrf_token %}
            <table class="table table-striped table-bordered align-middle">
              <thead class="table-dark sticky-top">
                <tr>
                  <th style="width: 40%;">Location</th>
                  <th style="width: 60%;">Item Code</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <!-- Location Input -->
                  <td>
                    <div class="mb-2">
                      <label for="location" class="form-label">Location</label>
                      <input type="text" name="location" id="myInput" class="form-control" readonly>
                    </div>
                    <div class="mb-2">
                      <label for="addl" class="form-label">Addl :</label>
                      <input type="text" name="addl" id="myInput1" class="form-control" readonly>
                    </div>
                  </td>

                  <!-- Item Input -->
                  <td>
                    <div class="mb-2">
                      <label for="addl" class="form-label">Add Item</label>
                      <input type="text" name="inputAddl" id="addl" autofocus placeholder="Scan Here ..."/>
                      <!-- <input type="text" id="addl" name="inputAddl" autofocus placeholder="Scan here..." /> -->
                    </div>                    
                    <button type="submit" id="" class="btn btn-primary btn-sm w-100" onclick="ac()">
                      Submit
                    </button><br>

                  </td>
                </tr>
              </tbody>
            </table>
          </form>
        </div>

        <!-- Django Messages -->
        <!--{% if messages %}-->
        <!--{% for message in messages %}-->
        <!--<div class="alert alert-danger mt-3">-->
        <!--    {{ message }}-->
        <!--</div>-->
        <!--{% endfor %}-->
        <!--{% endif %}-->
        <!-- {% if messages %}
        <div class="container mt-2">
          {% for message in messages %}
          <div class="alert
               {% if message.tags == 'success' %} alert-success
               {% elif message.tags == 'error' %} alert-danger
               {% else %} alert-info {% endif %}
               alert-dismissible fade show" role="alert">

            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endfor %}
        </div>
        {% endif %} -->

        <!-- Action Toggle Tabs -->
        <ul class="nav nav-tabs mb-3" id="barcodeTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="update-tab" data-bs-toggle="tab" data-bs-target="#update-form"
              type="button" role="tab">Update</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="delete-tab" data-bs-toggle="tab" data-bs-target="#delete-form" type="button"
              role="tab">Delete</button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="barcodeTab Content">
          <!-- Update Form -->
          <div class="tab-pane fade show active" id="update-form" role="tabpanel">
            <div class="card shadow p-3">
              <h5 class="card-title">Update Barcode</h5>
              <form action="/dataEnter" method="get">
                {% csrf_token %}
                <div class="mb-3">
                  <label for="addlUpdate" class="form-label">Enter Item Name:</label>
                  <input type="text" name="ITEMNAME" id="addlUpdate" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-success w-100">Search</button>
              </form>
            </div>
          </div>
          <!--Delete Form -->
          <div class="tab-pane fade show" id="delete-form" role="tabpanel">
            <div class="card shadow p-3">
              <h5 class="card-title">Delete Barcode</h5>
              <form action="" method="get">
                {% csrf_token %}
                <div class="mb-3">
                  <label for="locationNoDelete" class="form-label">Enter a Location No:</label>
                  <input type="text" name="locationNo" id="locationNoDelete" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-danger w-100">Delete</button>
              </form>
            </div>
          </div>




        </div>
        <br>
        <!-- Filter + Update Barcode in Same Row with Flex -->
        <div class="container mt-4">
          <div class="d-flex flex-wrap gap-3">

            <!-- Filter Form -->
            <!-- <div class="flex-fill" style="min-width: 300px; max-width: 48%;">
                            <div class="card shadow p-3 h-100">
                                <h5 class="card-title">üîç Filter Records</h5>
                                <form method="get" action="/filterData">
                                    <div class="mb-3">
                                        <label for="filterLocation" class="form-label">Location No</label>
                                        <input type="text" name="filterLocation" id="filterLocation"
                                            class="form-control" placeholder="Enter location no...">
                                    </div>
                                    <div class="mb-3">
                                        <label for="filterBarcode" class="form-label">Barcode</label>
                                        <input type="text" name="filterBarcode" id="filterBarcode" class="form-control"
                                            placeholder="Enter barcode...">
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Apply Filter</button>
                                </form>
                            </div>
                        </div> -->

            <br>

            <div class="container-fluid mt-4">

              <!-- Page Title -->
              <h2 class="mb-4 text-center text-primary fw-bold">
                üìä Scanning Records
              </h2>

              <!-- Card Wrapper -->
              <div class="card shadow-lg border-0 rounded-3">
                <div class="card-body">

                  <!-- Scrollable Table -->
                  <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                    <form method="post" action="/dataEnter">
                      {% csrf_token %}
                      <table class="table table-bordered table-striped table-hover align-middle text-center"
                        id="table1">
                        <thead class="table-dark sticky-top">
                          <tr>
                            <th scope="col">
                              <input type="checkbox" id="selectAll" class="form-check-input">
                            </th>
                            <th scope="col">#</th>
                            <th scope="col">Location</th>
                            <th scope="col">ADDL</th>
                            <th scope="col">Item Code</th>
                            <th scope="col">Item Name</th>
                            <th scope="col">Size</th>
                            <th scope="col">MRP</th>
                            <th scope="col">Brand</th>
                            <th scope="col">Section</th>
                            <th scope="col">Season</th>
                            <th scope="col">Colours</th>
                            <th scope="col">Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for row in result %}
                          <tr>
                            <td>
                              <input type="checkbox" name="selected_items" value="{{ row.id }}"
                                class="form-check-input">
                            </td>
                            <td>{{ row.id }}</td>
                            <td>{{ row.loc_rec }}</td>
                            <td>{{ row.add_item_list }}</td>
                            <td>{{ row.ITEMCODE }}</td>
                            <td>{{ row.ITEMNAME }}</td>
                            <td>{{ row.SIZE }}</td>
                            <td>{{ row.MRP }}</td>
                            <td>{{ row.BRANDNAME }}</td>
                            <td>{{ row.SECTION }}</td>
                            <td>{{ row.SEASON }}</td>
                            <td>{{ row.COLOURS }}</td>
                            <td>
                              <button type="submit" name="delete_id" value="{{ row.id }}" class="btn btn-sm btn-danger">
                                <i class="bi bi-trash"></i> Delete
                              </button>
                            </td>
                          </tr>
                          {% empty %}
                          <tr>
                            <td colspan="13" class="text-center text-muted">No records found</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>

                      <!-- Bulk Action -->
                      <!--<div class="d-flex justify-content-between align-items-center mt-3">-->
                      <!--  <p class="text-muted small mb-0">Select multiple rows to delete together.</p>-->
                      <!--  <button type="submit" name="bulk_delete" value="1" class="btn btn-outline-danger">-->
                      <!--    <i class="bi bi-trash-fill"></i> Delete Selected-->
                      <!--  </button>-->
                      <!--</div>-->
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

          <script>
            // Optional: Capture when Enter is pressed after scan
            document.getElementById("addl").addEventListener("keydown", function (event) {
              if (event.key === "Enter") {
                // alert("Scanned Code: " + this.value);
                // event.preventDefault();
                const code = this.value.trim();
                if (code) {
                  scans.push(code);  // Add to array
                  // localStorage.setItem("scans", JSON.stringify(scans)); // Save in localStorage
                  ls()
                  displayLoction();
                  displayAddl();
                }
                // displayLoction();
                // displayAddl();
                this.value = ""; // clear after scan
              }
            });

// document.addEventListener("DOMContentLoaded", () => {
//       const input = document.getElementById("addl");
//       const result = document.getElementById("result");
//       const scans = [];

//       input.addEventListener("keydown", (event) => {
//         if (event.key === "Enter") {
//           event.preventDefault();
//           const code = input.value.trim();
//           if (code) {
//             scans.push(code);
//            localStorage.setItem("ADDL", code)

//             //result.innerHTML += `<div>Scanned: ${code}</div>`;
//             // setVoiceAndSpeak(utterance, voices);
           
//             // displayLoction(); 


//             // or call ac() if defined
//           }
//           // Auto submit the form
//           form.submit();
//           input.value = "";
//           displayAddl();
//           input.focus();
//         }
//       });

//       //document.body.addEventListener("click", () => input.focus());
//     });


            function ls() {
              let lno = document.getElementById("lno").value;
              localStorage.setItem("Location", lno);
              displayLoction();
            }

            function displayLoction() {
              let storedName = localStorage.getItem("Location");
              document.getElementById("myInput").value = localStorage.getItem("Location");
              document.getElementById("myInput1").value = localStorage.getItem("ADDL");

              // document.getElementById("output").innerText = storedName;
            }

            function ac() {
              let an = document.getElementById("addl").value;
              localStorage.setItem("ADDL", an);
              displayAddl();

            }

            function displayAddl() {
              let storedName = localStorage.getItem("ADDL");
              document.getElementById("myInput1").value = localStorage.getItem("ADDL");
              document.getElementById("output1").innerText = storedName;


            }


            window.onload = displayLoction;
            // window.onload = displayAddl;

            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("overlay");
            const toggle = document.getElementById("menu-toggle");

            toggle.addEventListener("click", () => {
              sidebar.classList.toggle("active");
              overlay.classList.toggle("active");
            });

            overlay.addEventListener("click", () => {
              sidebar.classList.remove("active");
              overlay.classList.remove("active");
            });


            // Auto-submit when scanner sends "Enter"
            // const form = document.getElementById("scanForm");
            // const inputField = document.getElementById("addl");
            //           inputField.addEventListener("keypress", function (event) {
            //               if (event.key === "Enter") {
            //                   event.preventDefault(); // stop default form behavior
            //                   form.submit();          // auto-submit
            //                   ac()
            //               }
            //           });

            //           // (Optional) Auto-submit after input is filled (scanner types fast)
            //           inputField.addEventListener("change", function () {
            //             form.submit();
            //           });

            <!-- ‚úÖ Script for Select All -->

            document.getElementById("selectAll").addEventListener("click", function () {
              let checkboxes = document.querySelectorAll('input[name="selected_items"]');
              checkboxes.forEach(cb => cb.checked = this.checked);
            });

            // Select all Django messages
            const messageElements = document.querySelectorAll('.message-alert');

            messageElements.forEach(msgEl => {
              const text = msgEl.textContent.trim();
              if (!text) return;

              const utterance = new SpeechSynthesisUtterance(text);

              // Wait until voices are loaded
              const voices = window.speechSynthesis.getVoices();
              if (voices.length === 0) {
                // Some browsers require onvoiceschanged event
                window.speechSynthesis.onvoiceschanged = () => {
                  const voices = window.speechSynthesis.getVoices();
                  setVoiceAndSpeak(utterance, voices);
                };
              } else {
                setVoiceAndSpeak(utterance, voices);
              }
            });

            function setVoiceAndSpeak(utterance, voices) {
              // Pick an English female voice if available
              const voice = voices.find(v => v.lang === 'en-US' && v.name.includes('Female'));
              if (voice) {
                utterance.voice = voice;
              }
              window.speechSynthesis.speak(utterance);
            }


          </script>

</body>

</html>